# Build & Package a sample set of fuzzing targets

name: Package Samples
on: [push, pull_request]

jobs:
  linux_libfuzzer:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: |
          set -ex
          mkdir -p samples/linux-libfuzzer
          (cd examples/simple-libfuzzer ; make )
          cp -r examples/simple-libfuzzer/fuzz.exe examples/simple-libfuzzer/seeds samples/linux-libfuzzer
      - uses: actions/upload-artifact@v2.1.4
        with:
            name: samples
            path: samples
  windows_libfuzzer:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
      - run: |
          mkdir samples/windows-libfuzzer
          Set-ExecutionPolicy Bypass -Scope Process -Force 
          Invoke-Expression (Invoke-RestMethod 'https://chocolatey.org/install.ps1')
          choco install llvm
          choco install make
          cd examples/simple-libfuzzer
          make
          cp fuzz.exe,fuzz.pdb,seeds ../../samples/windows-libfuzzer -Recurse
        shell: powershell
      - uses: actions/upload-artifact@v2.1.4
        with:
            name: samples
            path: samples
